USE CDP
-- 重新插入含中文描述的權限資料
-- 清空
TRUNCATE TABLE FeaturePermissions;

-- 頂層節點，ParentUuid 為 NULL
-- 選單節點 BitValue = 0

-- 功能節點 BitValue = 2^n 從 0 開始算

-- 目錄節點 (BitValue = 0)
INSERT INTO FeaturePermissions (Uuid, ParentUuid, Icon, ModuleName, FeatureName, Title, Action, Link, BitValue, Sort, IsUse, IsVisible)
VALUES
('11111111-1111-1111-1111-111111111111', NULL, 'bi bi-house-door', 'Home', 'Home', N'首頁管理', NULL, '/home', 0, 1, 1, 1),
('22222222-2222-2222-2222-222222222222', NULL, 'bi bi-list', 'CDP', 'CDP', N'CDP工作流程管理', NULL, '/cdp', 0, 2, 1, 1),
('33333333-3333-3333-3333-333333333333', NULL, 'bi bi-list', 'Mailhunter', N'Mailhunter', N'Mail Hunter 報表', NULL, '/mailhunter', 0, 3, 1, 1),
('44444444-4444-4444-4444-444444444444', NULL, 'bi bi-list', 'MSMQ', 'MSMQ', N'MSMQ', NULL, '/msmq', 0, 4, 1, 1),
('55555555-5555-5555-5555-555555555555', NULL, 'bi bi-list', 'Permission', 'Permission', N'權限管理', NULL, '/Permission', 0, 5, 1, 1),

-- 功能節點 (從 2^0 開始)
('11111111-aaaa-aaaa-aaaa-111111111111', '11111111-1111-1111-1111-111111111111', 'bi bi-house-door', 'Home', 'Home', N'首頁管理', 'Read', '/home', 1, 1, 1, 1),

('22222222-aaaa-aaaa-aaaa-111111111111', '22222222-2222-2222-2222-222222222222', 'bi bi-envelope-open-fill', 'CDP', 'EDM_Main', N'EDM', 'Read', '/cdp/edm_main', 2, 1, 1, 1),
('22222222-aaaa-aaaa-aaaa-222222222222', '22222222-2222-2222-2222-222222222222', NULL, 'CDP', 'EDM_Detail', N'EDM 詳細頁', 'Read', '/cdp/edm_detail', 4, 2, 1, 0),

('22222222-bbbb-bbbb-bbbb-111111111111', '22222222-2222-2222-2222-222222222222', 'bi bi-chat-fill', 'CDP', 'SMS_Main', N'SMS', 'Read', '/cdp/sms_main', 8, 3, 1, 1),
('22222222-bbbb-bbbb-bbbb-222222222222', '22222222-2222-2222-2222-222222222222', NULL, 'CDP', 'SMS_Detail', N'SMS 詳細頁', 'Read', '/cdp/sms_detail', 16, 4, 1, 0),

('22222222-cccc-cccc-cccc-111111111111', '22222222-2222-2222-2222-222222222222', 'bi bi-bell-fill', 'CDP', 'APP_PUSH_Main', N'APP_PUSH', 'Read', '/cdp/app_push_main', 32, 5, 1, 1),
('22222222-cccc-cccc-cccc-222222222222', '22222222-2222-2222-2222-222222222222', NULL, 'CDP', 'APP_PUSH_Detail', N'APP_PUSH 詳細頁', 'Read', '/cdp/app_push_detail', 64, 6, 1, 0),

('33333333-aaaa-aaaa-aaaa-111111111111', '33333333-3333-3333-3333-333333333333', 'bi bi-file-earmark-text-fill', 'Mailhunter', 'Feedback_Markeed_Main', N'開信及點擊率報表', 'Read', '/mailhunter/feedback_marked_main', 128, 1, 1, 1),
('33333333-aaaa-aaaa-aaaa-222222222222', '33333333-3333-3333-3333-333333333333', NULL, 'Mailhunter', 'Feedback_Markeed_Main_Export', N'開信及點擊率報表 匯出', 'Export', NULL, 256, 2, 1, 0),

('33333333-aaaa-aaaa-aaaa-333333333333', '33333333-3333-3333-3333-333333333333', NULL, 'Mailhunter', 'Feedback_Markeed_Detail', N'開信及點擊率報表 詳細頁', 'Read', '/mailhunter/feedback_marked_detail', 512, 3, 1, 0),
('33333333-aaaa-aaaa-aaaa-444444444444', '33333333-3333-3333-3333-333333333333', NULL, 'Mailhunter', 'Feedback_Markeed_Detail_Export', N'開信及點擊率報表 詳細頁 匯出', 'Export', NULL, 1024, 4, 1, 0),

('33333333-bbbb-bbbb-bbbb-555555555555', '33333333-3333-3333-3333-333333333333', 'bi bi-file-earmark-text-fill', 'Mailhunter', 'Project_Mail_Count_Main', N'年度統計報表', 'Read', '/mailhunter/project_mail_count', 2048, 5, 1, 1),
('33333333-bbbb-bbbb-bbbb-666666666666', '33333333-3333-3333-3333-333333333333', NULL, 'Mailhunter', 'Project_Mail_Count_Mainl_Export', N'年度統計報表 匯出', 'Export', NULL, 4096, 6, 1, 0),

('44444444-aaaa-aaaa-aaaa-111111111111', '44444444-4444-4444-4444-444444444444', 'bi bi-gear', 'MSMQ', 'Queue', N'訊息佇列系統', 'Read', '/msmq/queue', 8192, 1, 1, 1),

('55555555-aaaa-aaaa-aaaa-111111111111', '55555555-5555-5555-5555-555555555555', 'bi bi-person-lock', 'Permission', 'Permission_Read', N'權限管理', 'Read', '/permission/permission_main', 16384, 1, 1, 1),
('55555555-aaaa-aaaa-aaaa-222222222222', '55555555-5555-5555-5555-555555555555', NULL, 'Permission', 'Permission_Create', N'權限管理 建立權限', 'Create', '/permission/mian', 32768, 2, 1, 0),
('55555555-aaaa-aaaa-aaaa-333333333333', '55555555-5555-5555-5555-555555555555', NULL, 'Permission', 'Permission_Update', N'權限管理 修改權限', 'Update', '/permission/mian', 65536, 3, 1, 0),
('55555555-aaaa-aaaa-aaaa-444444444444', '55555555-5555-5555-5555-555555555555', NULL, 'Permission', 'Permission_Delete', N'權限管理 刪除權限', 'Delete', '/permission/mian', 131072, 4, 1, 0);

-- 使用者 admin 擁有全部功能節點權限
DECLARE @AllFeatureMask BIGINT;

SELECT @AllFeatureMask = SUM(BitValue)
FROM FeaturePermissions
WHERE BitValue > 0; -- 排除目錄節點

-- 插入 admin 並套用全部權限
INSERT INTO Users (UserName, FeatureMask)
VALUES ('admin', @AllFeatureMask);
